<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0d1117; font-family: Inter, sans-serif; }
  #fatigue { width: 100%; max-width: 960px; margin: 0 auto; }
  .btm-note {
    text-align: center; color: #484f58; font-size: 11px;
    padding: 8px 16px; font-family: Inter, sans-serif;
    max-width: 960px; margin: 0 auto; line-height: 1.5;
  }
  @media (max-width: 600px) {
    .btm-note { font-size: 10px; padding: 6px 10px; }
  }
</style>
</head>
<body>
<div id="fatigue"></div>
<div class="btm-note">Bout 1 is always prone; bout 4 is always standing. Middle bouts mix positions,<br>which explains why women's bout 3 (mostly prone) appears to recover before the final standing bout.</div>
<script>
function isMobile() { return window.innerWidth < 600; }

const menData = [{"bout": 1, "mean": 82.79, "ci_low": 80.73, "ci_high": 84.86, "n": 265}, {"bout": 2, "mean": 81.51, "ci_low": 79.23, "ci_high": 83.79, "n": 265}, {"bout": 3, "mean": 78.74, "ci_low": 75.64, "ci_high": 81.84, "n": 175}, {"bout": 4, "mean": 78.4, "ci_low": 75.57, "ci_high": 81.23, "n": 175}];
const womenData = [{"bout": 1, "mean": 85.65, "ci_low": 83.52, "ci_high": 87.78, "n": 269}, {"bout": 2, "mean": 82.01, "ci_low": 79.9, "ci_high": 84.11, "n": 269}, {"bout": 3, "mean": 84.83, "ci_low": 82.27, "ci_high": 87.39, "n": 178}, {"bout": 4, "mean": 79.89, "ci_low": 77.1, "ci_high": 82.67, "n": 178}];

function makeTraces() {
  const bouts = ['Bout 1', 'Bout 2', 'Bout 3', 'Bout 4'];
  return [
    {
      type: 'scatter', mode: 'lines+markers', name: 'Men',
      x: bouts, y: menData.map(b => b.mean),
      error_y: {
        type: 'data', symmetric: false,
        array: menData.map(b => b.ci_high - b.mean),
        arrayminus: menData.map(b => b.mean - b.ci_low),
        color: '#00d4ff', thickness: 1.5, width: 4
      },
      line: {color: '#00d4ff', width: 2.5},
      marker: {color: '#00d4ff', size: isMobile() ? 8 : 10},
      hovertemplate: '<b>Men %{x}</b><br>Accuracy: %{y:.1f}%<br>95% CI: [%{customdata[0]:.1f}, %{customdata[1]:.1f}]<extra></extra>',
      customdata: menData.map(b => [b.ci_low, b.ci_high])
    },
    {
      type: 'scatter', mode: 'lines+markers', name: 'Women',
      x: bouts, y: womenData.map(b => b.mean),
      error_y: {
        type: 'data', symmetric: false,
        array: womenData.map(b => b.ci_high - b.mean),
        arrayminus: womenData.map(b => b.mean - b.ci_low),
        color: '#FFB347', thickness: 1.5, width: 4
      },
      line: {color: '#FFB347', width: 2.5},
      marker: {color: '#FFB347', size: isMobile() ? 8 : 10},
      hovertemplate: '<b>Women %{x}</b><br>Accuracy: %{y:.1f}%<br>95% CI: [%{customdata[0]:.1f}, %{customdata[1]:.1f}]<extra></extra>',
      customdata: womenData.map(b => [b.ci_low, b.ci_high])
    }
  ];
}

function getLayout() {
  const mobile = isMobile();
  const titleSize = mobile ? 14 : 18;
  const subtitleSize = mobile ? 10 : 13;
  return {
    title: {
      text: '<b>Accuracy Degrades With Cumulative Fatigue</b><br><span style="font-size:' + subtitleSize + 'px;color:#8b949e">All 4-bout formats (Individual, Pursuit, Mass Start). Error bars = 95% CI. ' + (mobile ? '' : 'Hover for details.') + '</span>',
      font: {size: titleSize, color: '#c9d1d9', family: 'Inter, sans-serif'},
      x: 0.5, xanchor: 'center'
    },
    xaxis: {
      color: '#c9d1d9', gridcolor: '#21262d',
      tickfont: {size: mobile ? 10 : 12}
    },
    yaxis: {
      color: '#8b949e', gridcolor: '#21262d',
      title: {text: mobile ? 'Accuracy (%)' : 'Shooting Accuracy (%)', font: {size: mobile ? 10 : 13, color: '#c9d1d9'}},
      tickfont: {size: mobile ? 9 : 11},
      range: [75, 89]
    },
    plot_bgcolor: '#0d1117', paper_bgcolor: '#0d1117',
    font: {family: 'Inter, sans-serif', color: '#c9d1d9'},
    legend: {
      bgcolor: 'rgba(13,17,23,0.9)', bordercolor: '#30363d', borderwidth: 1,
      font: {size: mobile ? 10 : 11},
      x: 0.5, y: -0.12, xanchor: 'center', orientation: 'h'
    },
    margin: {l: mobile ? 45 : 60, r: mobile ? 15 : 30, t: mobile ? 65 : 80, b: mobile ? 55 : 65},
    hoverlabel: {bgcolor: '#161b22', bordercolor: '#30363d', font: {family: 'Inter, sans-serif', size: 12, color: '#c9d1d9'}},
    annotations: [
      {
        text: 'Bout 3 = mostly prone<br>(easier position)',
        x: 'Bout 3', y: 84.83,
        ax: mobile ? 40 : 60, ay: mobile ? -40 : -50,
        showarrow: true, arrowhead: 0, arrowcolor: '#484f58',
        font: {size: mobile ? 9 : 11, color: '#c9d1d9'},
        bordercolor: '#30363d', borderwidth: 1, borderpad: 4,
        bgcolor: 'rgba(13,17,23,0.9)'
      },
      {
        text: '<span style="color:#FFB347">Women: −5.9pp</span>',
        x: 'Bout 4', y: 79.89,
        ax: mobile ? 35 : 50, ay: mobile ? 5 : 10,
        showarrow: true, arrowhead: 0, arrowcolor: '#FFB347',
        font: {size: mobile ? 10 : 12, color: '#FFB347'}
      },
      {
        text: '<span style="color:#00d4ff">Men: −5.1pp</span>',
        x: 'Bout 4', y: 78.4,
        ax: mobile ? 35 : 50, ay: mobile ? 20 : 25,
        showarrow: true, arrowhead: 0, arrowcolor: '#00d4ff',
        font: {size: mobile ? 10 : 12, color: '#00d4ff'}
      },
      {
        text: 'Data: IBU Datacenter | Beyond the Metric',
        xref: 'paper', yref: 'paper', x: 0.5, y: -0.18,
        showarrow: false, font: {size: mobile ? 8 : 10, color: '#484f58'}, xanchor: 'center'
      }
    ]
  };
}

const config = {
  responsive: true,
  displayModeBar: !isMobile(),
  modeBarButtonsToRemove: ['select2d', 'lasso2d', 'autoScale2d'],
  displaylogo: false,
  toImageButtonOptions: {format: 'png', filename: 'btm_fatigue', height: 800, width: 1200, scale: 2}
};

function render() {
  Plotly.react('fatigue', makeTraces(), getLayout(), {...config, displayModeBar: !isMobile()});
}

render();

let resizeTimer;
window.addEventListener('resize', function() {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(render, 150);
});
</script>
</body>
</html>